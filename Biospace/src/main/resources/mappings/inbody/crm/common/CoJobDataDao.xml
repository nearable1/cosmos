<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.inbody.crm.common.persistence.CoJobDataDao">

    <sql id="coJobDataColumns">
        a.id AS "id",
        a.proc_ins_id AS "procInsId",
        a.create_by AS "createBy.id",
        a.create_date AS "createDate",
        a.update_by AS "updateBy.id",
        a.update_date AS "updateDate",
        a.del_flag AS "delFlag",
        a.type AS "type",
        a.ass_id AS "assId",
        a.file_name AS "fileName",
        a.exp_turnover_month AS "expTurnoverMonth",
        a.method AS "method"
    </sql>

    <sql id="coJobDataJoins">
    </sql>

    <select id="get" resultType="CoJobData">
        SELECT 
            <include refid="coJobDataColumns"/>
        FROM co_job_data a
        <include refid="coJobDataJoins"/>
        WHERE a.id = #{id}
    </select>

    <select id="findList" resultType="CoJobData">
        SELECT 
            <include refid="coJobDataColumns"/>
        FROM co_job_data a
        <include refid="coJobDataJoins"/>
        <where>
            a.del_flag = #{DEL_FLAG_NORMAL}
        </where>
        <choose>
            <when test="page !=null and page.orderBy != null and page.orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
                ORDER BY a.update_date DESC
            </otherwise>
        </choose>
    </select>

    <select id="findAllList" resultType="CoJobData">
        SELECT 
            <include refid="coJobDataColumns"/>
        FROM co_job_data a
        <include refid="coJobDataJoins"/>
        <where>
            a.del_flag = #{DEL_FLAG_NORMAL}
        </where>        
        <choose>
            <when test="page !=null and page.orderBy != null and page.orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
                ORDER BY a.update_date DESC
            </otherwise>
        </choose>
    </select>

    <insert id="insert">
        INSERT INTO co_job_data(
            id,
            proc_ins_id,
            create_by,
            create_date,
            update_by,
            update_date,
            del_flag,
            type,
            ass_id,
            file_name,
            exp_turnover_month,
            method
        ) VALUES (
            #{id},
            #{procInsId},
            #{createBy.id},
            #{createDate},
            #{updateBy.id},
            #{updateDate},
            #{delFlag},
            #{type},
            #{assId},
            #{fileName},
            #{expTurnoverMonth},
            #{method}
        )
    </insert>

    <update id="update">
        UPDATE co_job_data SET
            proc_ins_id = #{procInsId},
            update_by = #{updateBy.id},
            update_date = #{updateDate},
            type = #{type},
            ass_id = #{assId},
            file_name = #{fileName},
            exp_turnover_month = #{expTurnoverMonth},
            method = #{method}
        WHERE id = #{id}
    </update>

    <update id="delete">
        UPDATE co_job_data SET 
            del_flag = #{DEL_FLAG_DELETE}
        WHERE id = #{id}
    </update>

    <!-- 履历一览分页查询 -->
    <select id="findPageList" resultType="CoJobData">
        SELECT 
            <include refid="coJobDataColumns"/>,
            IF(ISNULL(b.name), a.create_by, b.name) AS "executor"
        FROM co_job_data a
        LEFT JOIN sys_user b ON b.id = a.create_by
        <where>
            a.del_flag = #{DEL_FLAG_NORMAL}
            <if test="type != null and type != ''">
                AND a.type = #{type}
            </if>
            <if test="expTurnoverMonth != null and expTurnoverMonth != ''">
                AND DATE_FORMAT(a.exp_turnover_month, '%Y-%m') = DATE_FORMAT(#{expTurnoverMonth}, '%Y-%m')
            </if>
            <if test="executeDateFrom != null and executeDateFrom != ''">
                AND DATE_FORMAT(a.create_date, '%Y-%m-%d') &gt;= DATE_FORMAT(#{executeDateFrom}, '%Y-%m-%d')
            </if>
            <if test="executorDateTo != null and executorDateTo != ''">
                AND DATE_FORMAT(a.create_date, '%Y-%m-%d') &lt;= DATE_FORMAT(#{executorDateTo}, '%Y-%m-%d')
            </if>
        </where>
        ORDER BY a.create_date DESC
    </select>
</mapper>